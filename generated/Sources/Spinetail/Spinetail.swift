//
// Generated by SwagGen
// https://github.com/yonaskolb/SwagGen
//

import Foundation
import PrchModel


public typealias DateTime = Date
public typealias File = Data
public typealias ID = UUID

public enum STSurveys {}
public enum STAccountExport {}
public enum STAccountExports {}
public enum STActivityFeed {}
public enum STAuthorizedApps {}
public enum STAutomations {}
public enum STBatchWebhooks {}
public enum STBatches {}
public enum STCampaignFolders {}
public enum STCampaigns {}
public enum STConnectedSites {}
public enum STConversations {}
public enum STCustomerJourneys {}
public enum STEcommerce {}
public enum STFacebookAds {}
public enum STFileManager {}
public enum STLandingPages {}
public enum STLists {}
public enum STPing {}
public enum STReporting {}
public enum STReports {}
public enum STRoot {}
public enum STSearchCampaigns {}
public enum STSearchMembers {}
public enum STTemplateFolders {}
public enum STTemplates {}
public enum STVerifiedDomains {}



public class SpinetailAPI: API {
  private let apiKey : String
  private let dc: String
  
  public init?(apiKey: String) {
    self.apiKey = apiKey
    let apiKeyComponents = apiKey.components(separatedBy: "-")

    guard let dc = apiKeyComponents.last, apiKeyComponents.count == 2 else {
      return nil
    }

    self.dc = dc
    
    

    guard let baseURLComponents = URLComponents(string:  "https://\(dc).api.mailchimp.com/3.0") else {
      return nil
    }
    self.baseURLComponents = baseURLComponents

  }
  
  public let baseURLComponents: URLComponents


  public var headers: [String: String] {
    [
      "Authorization": "anystring \(self.apiKey)",
      "Content-type": "application/json; charset=utf-8"
    ]
  }

  public var encoder: any Encoder<Data> {
	Defaults.encoder
  }

  public var decoder: any Decoder<Data> {
	Defaults.decoder
  }

  public typealias RequestDataType = Data

  public typealias ResponseDataType = Data
}

extension JSONDecoder {
  convenience init(dateFormatter: DateFormatter) {
	self.init()
	self.dateDecodingStrategy = .formatted(dateFormatter)
  }
}

extension JSONEncoder {
  convenience init(dateFormatter: DateFormatter) {
	self.init()
	self.dateEncodingStrategy = .formatted(dateFormatter)
  }
}

extension SpinetailAPI {
  enum Defaults {
    public static let dateEncodingFormatter = {
      let formatter = DateFormatter()
      formatter.dateFormat = "yyyy-MM-dd'T'HH:mm:ssZZZZZ"
      formatter.locale = Locale(identifier: "en_US_POSIX")
      formatter.calendar = Calendar(identifier: .gregorian)
      return formatter
    }()
    
    public static let encoder: any Encoder<Data> = JSONEncoder(dateFormatter: Self.dateEncodingFormatter)
    
    public static let decoder: any Decoder<Data> = JSONDecoder(dateFormatter: Self.dateEncodingFormatter)
  }

}
